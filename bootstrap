#! /bin/sh
cd `dirname $0`
# Check libtoolize version, fix for Debian/Woody
lt=`which libtoolize`
if test -n "$lt" ; then
	if test -x "$lt" ; then
		LTIZE_VER=`libtoolize --version | head -1 | sed 's/^[^0-9]*//'`
		LTIZE_VER_MAJOR=`echo $LTIZE_VER | cut -f1 -d'.'`
		LTIZE_VER_MINOR=`echo $LTIZE_VER | cut -f2 -d'.'`

		if test "$LTIZE_VER_MAJOR" -lt "2" -a "$LTIZE_VER_MINOR" -lt "4" ; then
			WOODY_FIX="yes";
		fi
	fi
fi

# Check Autoconf version
ac=`which autoconf`
if test -n "$ac" ; then
	if test -x "$ac" ; then
		AC_VER=`autoconf --version | head -1 | sed 's/^[^0-9]*//'`
		AC_VER_MAJOR=`echo $AC_VER | cut -f1 -d'.'`
		AC_VER_MINOR=`echo $AC_VER | cut -f2 -d'.' | sed 's/[^0-9]*$//'`

		if test "$AC_VER_MAJOR" -lt "2" ; then
			echo "Autoconf 2.13 or greater needed to build configure."
			exit 1
		fi

		if test "$AC_VER_MINOR" -lt "13" ; then
			echo "Autoconf 2.13 or greater needed to build configure."
			exit 1
		fi

		if test "$AC_VER_MINOR" -lt "50" ; then
			if test ! -e configure.in ; then
				ln -s configure.ac configure.in
			fi
			echo "If you see some warnings about cross-compiling, don't worry; this is normal."
		elif test "$WOODY_FIX" = "yes" ; then
			if test ! -e configure.in ; then
				ln -s configure.ac configure.in
			fi
		else
			rm -f configure.in
		fi
	fi
else
	echo Autoconf not found. QuakeForge CVS requires autoconf to bootstrap itself.
	exit 1
fi

aclocal && autoheader && libtoolize --automake && automake --add-missing && autoconf
